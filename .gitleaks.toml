# Gitleaks configuration file for spring-petclinic-microservices
# This file defines custom rules for detecting secrets in the codebase

title = "Gitleaks Configuration for Spring PetClinic Microservices"

# Extend default gitleaks rules
[extend]
useDefault = true

# Custom rules for Spring Boot applications
[[rules]]
id = "spring-datasource-password"
description = "Detected Spring datasource password in configuration"
regex = '''spring\.datasource\.password\s*[:=]\s*['""]?([^'"\s]{8,})['""]?'''
tags = ["spring", "password", "datasource"]
[[rules.Entropies]]
    Min = "3.5"
    Max = "8"

[[rules]]
id = "spring-datasource-username"
description = "Detected Spring datasource username in configuration"
regex = '''spring\.datasource\.username\s*[:=]\s*['"]?([^'"\s]{3,})['"]?'''
tags = ["spring", "username", "datasource"]

[[rules]]
id = "jwt-secret"
description = "Detected JWT secret key"
regex = '''(?i)(jwt[._-]?secret|secret[._-]?key)\s*[:=]\s*['"]?([a-zA-Z0-9+/=]{32,})['"]?'''
tags = ["jwt", "secret", "key"]

[[rules]]
id = "api-key-header"
description = "Detected API key in header or configuration"
regex = '''(?i)(x-api-key|api[._-]?key|apikey)\s*[:=]\s*['"]?([a-zA-Z0-9_\-]{20,})['"]?'''
tags = ["api", "key"]

[[rules]]
id = "oauth-client-secret"
description = "Detected OAuth client secret"
regex = '''(?i)(client[._-]?secret|oauth[._-]?secret)\s*[:=]\s*['"]?([a-zA-Z0-9_\-]{20,})['"]?'''
tags = ["oauth", "secret"]

[[rules]]
id = "aws-access-key"
description = "Detected AWS Access Key ID"
regex = '''(?i)(aws[._-]?access[._-]?key[._-]?id|aws[._-]?key)\s*[:=]\s*['"]?(AKIA[0-9A-Z]{16})['"]?'''
tags = ["aws", "key"]

[[rules]]
id = "aws-secret-key"
description = "Detected AWS Secret Access Key"
regex = '''(?i)aws[._-]?secret[._-]?access[._-]?key\s*[:=]\s*['"]?([a-zA-Z0-9/+=]{40})['"]?'''
tags = ["aws", "secret"]

[[rules]]
id = "docker-registry-password"
description = "Detected Docker registry password"
regex = '''(?i)docker[._-]?(registry[._-]?)?password\s*[:=]\s*['"]?([^'"\s]{8,})['"]?'''
tags = ["docker", "password"]

[[rules]]
id = "private-key-material"
description = "Detected private key material"
regex = '''-----BEGIN\s+(RSA|DSA|EC|OPENSSH|PGP)\s+PRIVATE KEY-----'''
tags = ["private", "key", "pem"]

[[rules]]
id = "generic-api-token"
description = "Detected generic API token"
regex = '''(?i)(token|bearer)\s*[:=]\s*['"]?([a-zA-Z0-9_\-\.]{32,})['"]?'''
tags = ["token", "api"]

# Allowlist for test files and examples
[allowlist]
description = "Allowlisted files and paths"
paths = [
    '''\.git/''',
    '''node_modules/''',
    '''target/''',
    '''\.m2/''',
    '''\.idea/''',
    '''\*\.lock''',
    '''\*-lock\.json''',
    '''docs/GIT-HOOKS-SETUP\.md''',
    '''GIT-HOOKS-QUICKSTART\.md''',
    '''\.env\.example''',
]

regexes = [
    # Allow test/example passwords
    '''password\s*[:=]\s*['"]?(test|example|dummy|changeme|password123)['"]?''',
    # Allow placeholder secrets
    '''(?i)(secret|password|key)\s*[:=]\s*['"]?(YOUR_|REPLACE_|CHANGE_|INSERT_|<|xxx|yyy)''',
    # Allow environment variable references
    '''\$\{[A-Z_]+\}''',
    '''ENV\[['""][A-Z_]+['""]''',
]

# Files to ignore completely
stopwords = [
    "test",
    "example",
    "sample",
    "dummy",
    "changeme",
]
